---
/**
 * Events page — mission board of upcoming and past events.
 * PRD 006: Events Page Redesign
 */
import BaseLayout from "../layouts/BaseLayout.astro";
import EventCard from "../components/EventCard.astro";
import { getCollection } from "astro:content";
import { splitEventsByStatus } from "../lib/events";

const allEvents = await getCollection("events");
// Date-derived partitions reflect the current build snapshot.
const { upcoming, past } = splitEventsByStatus(allEvents);
---

<BaseLayout
  title="Events"
  description="Upcoming and past Ghostbusters Virginia events across the Commonwealth, including conventions, parades, and charity appearances."
  canonical="/events"
  ogTitle="Events | Ghostbusters Virginia"
  ogDescription="Find where Ghostbusters Virginia will be next and browse our past appearances."
  ogImage="/images/gbv-gallery-12.jpg"
>
  <section class="container page" aria-labelledby="events-title">
    <h1 id="events-title" class="page-title">Events</h1>
    <p class="page-intro">Meet the team, support local charities, and see the Ecto in person.</p>

    {
      upcoming.length > 0 && (
        <div class="event-section fade-in-section">
          <h2 class="section-heading">Upcoming Events</h2>
          <ul class="event-list" role="list">
            {upcoming.map((event) => (
              <EventCard event={event} status="upcoming" showCountdown />
            ))}
          </ul>
        </div>
      )
    }

    {
      past.length > 0 && (
        <div class="event-section fade-in-section">
          <h2 class="section-heading">Past Events</h2>
          <ul class="event-list event-list--past" id="past-events-list" role="list">
            {past.map((event, index) => (
              <EventCard event={event} status="past" className={index >= 4 ? "past-hidden" : ""} />
            ))}
          </ul>
          {past.length > 4 && (
            <div class="past-toggle">
              <button class="toggle-btn" type="button" id="past-show-more">
                Show More ({past.length - 4} more)
              </button>
              <button class="toggle-btn" type="button" id="past-show-less" hidden>
                Show Less
              </button>
            </div>
          )}
        </div>
      )
    }

    {allEvents.length === 0 && <p class="empty-state">No events yet — check back soon!</p>}
  </section>
</BaseLayout>

<script>
  const showMoreBtn = document.getElementById("past-show-more") as HTMLButtonElement | null;
  const showLessBtn = document.getElementById("past-show-less") as HTMLButtonElement | null;
  const hiddenItems = document.querySelectorAll<HTMLElement>("#past-events-list .past-hidden");

  showMoreBtn?.addEventListener("click", () => {
    hiddenItems.forEach((item) => item.classList.remove("past-hidden"));
    showMoreBtn.hidden = true;
    showLessBtn!.hidden = false;
  });

  showLessBtn?.addEventListener("click", () => {
    hiddenItems.forEach((item) => item.classList.add("past-hidden"));
    showLessBtn.hidden = true;
    showMoreBtn!.hidden = false;
    document
      .getElementById("past-events-list")
      ?.scrollIntoView({ behavior: "smooth", block: "start" });
  });
</script>

<style>
  /* ── Event section layout ── */
  .event-section {
    width: 100%;
  }

  /* ── Event list ── */
  .event-list {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
  }

  /* ── Past events hidden items ── */
  .past-hidden {
    display: none;
  }

  /* ── Past toggle buttons ── */
  .past-toggle {
    display: flex;
    justify-content: center;
    margin-top: var(--space-xl);
  }
</style>
