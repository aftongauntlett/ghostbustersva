---
/**
 * Site header with responsive navigation.
 * Uses a <details> element for mobile menu — no JS required, fully accessible.
 * Logo sits proud above the nav bar, inspired by the original GBV site.
 */
import { siteConfig } from "../config";

const currentPath = Astro.url.pathname;
---

<header class="site-header">
  <div class="container header-inner">
    <a href="/" class="site-logo" aria-label={`${siteConfig.title} — home`}>
      <img src="/images/logo.png" alt="" width="72" height="72" class="logo-img" />
      <span class="logo-text">
        <span class="logo-text-main">Ghostbusters</span>
        <span class="logo-text-sub">Virginia</span>
      </span>
    </a>

    {/* Mobile menu toggle — progressively enhanced, works without JS */}
    <details class="mobile-nav">
      <summary aria-label="Open navigation menu">
        <span class="hamburger" aria-hidden="true">&#9776;</span>
      </summary>
      <nav class="nav-links mobile" aria-label="Main navigation">
        <ul>
          {
            siteConfig.nav.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="nav-active-link"
                  aria-current={currentPath === link.href ? "page" : undefined}
                  {...("external" in link ? { target: "_blank", rel: "noopener noreferrer" } : {})}
                >
                  {link.label}
                  {"external" in link && <span class="sr-only"> (opens in new tab)</span>}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </details>

    {/* Desktop nav — hidden on small screens via CSS */}
    <nav class="nav-links desktop" aria-label="Main navigation">
      <ul>
        {
          siteConfig.nav.map((link) => (
            <li>
              <a
                href={link.href}
                class="nav-active-link"
                aria-current={currentPath === link.href ? "page" : undefined}
                {...("external" in link ? { target: "_blank", rel: "noopener noreferrer" } : {})}
              >
                {link.label}
                {"external" in link && <span class="sr-only"> (opens in new tab)</span>}
              </a>
            </li>
          ))
        }
      </ul>
    </nav>
  </div>

  {/* Proton-stream divider — contained width, not full bleed */}
  <div class="container">
    <div class="header-divider" aria-hidden="true"></div>
  </div>
</header>

<style>
  .site-header {
    background: var(--color-bg);
    border-bottom: none;
    position: sticky;
    top: 0;
    z-index: 100;
  }

  /* Proton-stream divider — contained, fades at edges */
  .header-divider {
    height: 2px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(--color-glow) 20%,
      var(--color-divider-structural) 40%,
      var(--color-action-primary-hover) 50%,
      var(--color-divider-structural) 60%,
      var(--color-glow) 80%,
      transparent 100%
    );
    box-shadow:
      0 0 6px var(--color-glow),
      0 0 15px var(--color-glow-dim);
    border-radius: 1px;
  }

  .header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-block: var(--space-sm);
  }

  /* -------------------------------------------------- */
  /* Logo — sits proud, overlapping the nav bar          */
  /* -------------------------------------------------- */
  .site-logo {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    text-decoration: none;
    color: var(--color-text);
    position: relative;
    z-index: 2;
    transition: transform var(--transition-fast);
  }

  .logo-img {
    filter: drop-shadow(0 0 6px var(--color-glow));
    transition:
      filter var(--transition-base),
      transform var(--transition-base);
    /* Push the logo up so it "breaks out" of the header bar */
    margin-block: -0.5rem;
  }

  .site-logo:hover .logo-img,
  .site-logo:focus-visible .logo-img {
    filter: drop-shadow(0 0 12px var(--color-glow-green))
      drop-shadow(0 0 20px var(--color-glow-green));
    transform: scale(1.05);
  }

  .logo-text {
    display: flex;
    flex-direction: column;
    line-height: 1.1;
  }

  .logo-text-main {
    font-family: var(--font-heading);
    font-weight: var(--weight-bold);
    font-size: 1.15rem;
    letter-spacing: var(--tracking-wider);
    text-transform: uppercase;
    color: var(--color-text);
    transition: color var(--transition-fast);
  }

  .logo-text-sub {
    font-family: var(--font-heading);
    font-weight: var(--weight-medium);
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--color-link);
    transition: color var(--transition-fast);
  }

  .site-logo:hover .logo-text-main {
    color: var(--color-text);
  }
  .site-logo:hover .logo-text-sub {
    color: var(--color-link-hover);
  }

  /* -------------------------------------------------- */
  /* Nav links                                          */
  /* -------------------------------------------------- */
  .nav-links ul {
    list-style: none;
    display: flex;
    gap: var(--space-xs);
  }

  .nav-links a {
    text-decoration: none;
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: var(--weight-medium);
    letter-spacing: var(--tracking-wide);
    text-transform: uppercase;
    white-space: nowrap;
    color: var(--color-text-muted);
    padding: 0.4rem 0.75rem;
    border-radius: var(--radius-sm);
    position: relative;
    transition:
      color var(--transition-fast),
      background var(--transition-fast);
  }

  /* Hover: red glow underline slides in from left */
  .nav-links a::after {
    content: "";
    position: absolute;
    bottom: 2px;
    left: 0.75rem;
    width: 0;
    height: 2px;
    background: var(--color-accent-hover);
    box-shadow: 0 0 6px var(--color-glow);
    border-radius: var(--radius-full);
    transition: width var(--transition-base);
  }

  .nav-links a:hover,
  .nav-links a:focus-visible {
    color: var(--color-text);
    background: var(--color-nav-hover-bg);
  }

  .nav-links a:hover::after,
  .nav-links a:focus-visible::after {
    width: calc(100% - 1.5rem);
  }

  /* Active page state */
  .nav-links a[aria-current="page"] {
    color: var(--color-accent-hover);
    font-weight: var(--weight-semibold);
    text-shadow: 0 0 8px var(--color-glow);
  }

  .nav-links a[aria-current="page"]::after {
    width: calc(100% - 1.5rem);
    background: var(--color-nav-active);
    box-shadow:
      0 0 6px var(--color-glow),
      0 0 12px var(--color-glow-red-subtle);
  }

  /* Desktop nav */
  .nav-links.desktop {
    display: none;
  }
  @media (min-width: 768px) {
    .nav-links.desktop {
      display: block;
    }
    .mobile-nav {
      display: none;
    }
  }

  /* -------------------------------------------------- */
  /* Mobile nav                                          */
  /* -------------------------------------------------- */
  .mobile-nav {
    position: relative;
  }
  .mobile-nav summary {
    list-style: none;
    cursor: pointer;
    font-size: 1.5rem;
    color: var(--color-text);
    transition: color var(--transition-fast);
  }
  .mobile-nav summary:hover {
    color: var(--color-accent-hover);
  }
  .mobile-nav summary::-webkit-details-marker {
    display: none;
  }
  .mobile-nav .nav-links ul {
    flex-direction: column;
    gap: var(--space-xs);
    position: absolute;
    right: 0;
    top: 2.5rem;
    background: var(--color-surface);
    border: 1px solid var(--color-glow);
    border-radius: var(--radius-md);
    padding: var(--space-md) var(--space-sm);
    min-width: 11rem;
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.5),
      0 0 15px var(--color-glow-red-faint);
  }

  .mobile-nav .nav-links a {
    display: block;
    padding: var(--space-sm) var(--space-lg);
    border-radius: var(--radius-sm);
  }

  /* -------------------------------------------------- */
  /* Responsive adjustments                              */
  /* -------------------------------------------------- */
  @media (max-width: 767px) {
    .logo-img {
      width: 56px;
      height: 56px;
    }
    .logo-text-main {
      font-size: 1rem;
    }
    .logo-text-sub {
      font-size: 0.6rem;
    }
  }
</style>
